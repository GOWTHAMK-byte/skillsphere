{% extends 'base.html' %}

{% block head %}
{{ super() }}
<style>
  /* For the animated gradient text */
  @keyframes gradient-animation {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  .animate-gradient {
    background-size: 200% 200%;
    animation: gradient-animation 8s ease infinite;
  }
</style>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">

    <div class="text-center mb-16">
        <h1 class="text-5xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-sky-400 via-rose-400 to-lime-400 animate-gradient mb-4">
            Welcome, {{ current_user.profile.name or current_user.username }}!
        </h1>
        <p class="text-lg text-violet-200/80 max-w-3xl mx-auto">This is your command center. Track your teams, manage applications, and launch your next great project.</p>
        <div class="mt-8">
            <a href="{{ url_for('create_post') }}" class="inline-flex items-center gap-3 px-8 py-3 bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white font-bold rounded-lg text-base shadow-lg hover:shadow-fuchsia-500/40 transition-all duration-300 transform hover:scale-105 focus-ring">
                <svg class="h-6 w-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                Create a New Post
            </a>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
        <div class="space-y-8">
            <h2 class="text-3xl font-bold text-violet-100 flex items-center gap-3">
                <svg class="h-8 w-8 text-fuchsia-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a4 4 0 00-3-3.87M9 20H4v-2a4 4 0 013-3.87m9-4V7a4 4 0 00-8 0v3m8 4a4 4 0 01-8 0" /></svg>
                Your Teams
            </h2>
            {% if teams %}
                <ul class="space-y-6">
                    {% for post in teams %}
                        <li class="bg-black/30 backdrop-blur-md border border-violet-900/60 rounded-xl p-5 shadow-lg transition-all duration-300 hover:border-violet-700/80 hover:shadow-violet-500/20">
                            <div class="flex justify-between items-start">
                                <a href="{{ url_for('user', username=post.creator.username) }}" class="text-fuchsia-300 hover:text-fuchsia-200 font-bold text-lg">{{ post.event_name }}</a>
                                <span class="text-xs bg-violet-800/60 text-violet-200 px-3 py-1 rounded-full font-semibold">{{ post.event_type }}</span>
                            </div>
                            <p class="text-xs text-violet-400 mt-1 mb-4">Created on {{ post.timestamp.strftime('%B %d, %Y') }}</p>

                            <div class="text-sm text-violet-300">
                                <span class="font-semibold">Teammates:</span>
                                <div class="flex flex-wrap gap-2 mt-2">
                                    <span class="bg-violet-500/20 text-violet-100 px-3 py-1 rounded-full text-xs font-medium border border-violet-500/30">
                                        {{ post.creator.username }} (Creator)
                                    </span>
                                    {% for member in post.teammates %}{% if member != post.creator %}
                                        <span class="bg-violet-500/10 text-violet-200 px-3 py-1 rounded-full text-xs font-medium border border-violet-500/20">
                                            {{ member.username }}{% if member == current_user %} (You){% endif %}
                                        </span>
                                    {% endif %}{% endfor %}
                                </div>
                            </div>
                            <div class="flex items-center gap-3 mt-5 border-t border-white/10 pt-4">
                                {% if post.creator == current_user or current_user in post.teammates %}
                                    <a href="{{ url_for('chat', post_id=post.id) }}" class="flex-1 text-center bg-violet-600 hover:bg-violet-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors text-sm focus-ring">Team Chat</a>
                                {% endif %}
                                {% if post.creator == current_user %}
                                    <a href="{{ url_for('manage_post', post_id=post.id) }}" class="flex-1 text-center bg-fuchsia-600 hover:bg-fuchsia-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors text-sm focus-ring">Manage</a>
                                {% elif current_user in post.teammates %}
                                    <form method="post" action="{{ url_for('leave_team', post_id=post.id) }}" class="flex-1">
                                        <button type="submit" class="w-full bg-red-800/70 hover:bg-red-700/80 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors text-sm focus-ring" onclick="return confirm('Are you sure you want to leave this team?');">Leave Team</button>
                                    </form>
                                {% endif %}
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <div class="bg-black/20 border-2 border-dashed border-violet-900/60 rounded-xl p-12 text-center">
                    <svg class="mx-auto h-12 w-12 text-violet-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a4 4 0 00-3-3.87M9 20H4v-2a4 4 0 013-3.87m9-4V7a4 4 0 00-8 0v3m8 4a4 4 0 01-8 0" /></svg>
                    <h3 class="mt-4 text-lg font-semibold text-white">No Teams Yet</h3>
                    <p class="mt-1 text-sm text-violet-300">Create a post or join a team to get started.</p>
                </div>
            {% endif %}
        </div>

        <div class="space-y-8">
            <h2 class="text-3xl font-bold text-violet-100 flex items-center gap-3">
                <svg class="h-8 w-8 text-fuchsia-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                Your Applications
            </h2>
            {% if applications %}
                <ul class="space-y-6">
                    {% for app in applications %}
                        <li class="bg-black/30 backdrop-blur-md border border-violet-900/60 rounded-xl p-5 shadow-lg transition-all duration-300 hover:border-violet-700/80 hover:shadow-fuchsia-500/20">

                            {# --- Conditional block for Invitations --- #}
                            {% if app.status == 'Invited' %}
                            <div>
                                <p class="text-violet-200">
                                    <a href="{{ url_for('user', username=app.post.creator.username) }}" class="font-bold text-fuchsia-300 hover:underline">{{ app.post.creator.username }}</a>
                                    has invited you to join the project:
                                    <span class="font-bold text-white">{{ app.post.event_name }}</span>
                                </p>
                                <p class="text-xs text-fuchsia-400 mt-1">Invited on {{ app.timestamp.strftime('%B %d, %Y') }}</p>
                                <div class="mt-4 flex items-center gap-3 border-t border-white/10 pt-4">
                                    <form method="post" action="{{ url_for('handle_invitation', application_id=app.id, action='accept') }}" class="flex-1">
                                        <button type="submit" class="w-full bg-green-600 hover:bg-green-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors text-sm focus-ring">Accept</button>
                                    </form>
                                    <form method="post" action="{{ url_for('handle_invitation', application_id=app.id, action='reject') }}" class="flex-1">
                                        <button type="submit" class="w-full bg-red-800/70 hover:bg-red-700/80 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors text-sm focus-ring">Reject</button>
                                    </form>
                                </div>
                            </div>

                            {# --- Logic for standard applications --- #}
                            {% else %}
                            <div>
                                <div class="flex justify-between items-start">
                                    <span class="text-fuchsia-300 font-bold text-lg">{{ app.post.event_name }}</span>
                                    {% if app.status == 'Accepted' %}
                                        <span class="text-xs bg-green-800/60 text-green-200 px-3 py-1 rounded-full font-semibold">Accepted</span>
                                    {% elif app.status == 'Rejected' %}
                                        <span class="text-xs bg-red-800/60 text-red-200 px-3 py-1 rounded-full font-semibold">Rejected</span>
                                    {% else %}
                                        <span class="text-xs bg-gray-800/60 text-gray-200 px-3 py-1 rounded-full font-semibold">Pending</span>
                                    {% endif %}
                                </div>
                                <p class="text-xs text-fuchsia-400 mt-1">Applied on {{ app.timestamp.strftime('%B %d, %Y') }}</p>
                                <div class="mt-4 flex justify-between items-center border-t border-white/10 pt-4">
                                    <a href="{{ url_for('user', username=app.post.creator.username) }}" class="bg-white/10 hover:bg-white/20 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm focus-ring">View Post</a>
                                </div>
                            </div>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                 <div class="bg-black/20 border-2 border-dashed border-violet-900/60 rounded-xl p-12 text-center">
                    <svg class="mx-auto h-12 w-12 text-fuchsia-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                    <h3 class="mt-4 text-lg font-semibold text-white">No Applications Yet</h3>
                    <p class="mt-1 text-sm text-fuchsia-300">Find an interesting project on the home page to apply.</p>
                </div>
            {% endif %}
        </div>
        </div>
    </div>
{% endblock %}